<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Butternut r√¥ti aux √âpices par Yat√© DOUKANSY, 3PMT</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet" />

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f7f7f7;
    }
    .tab-button {
      transition: all 0.2s;
      padding-top: 0.75rem;
      padding-bottom: 0.75rem;
      padding-left: 1.5rem;
      padding-right: 1.5rem;
    }
    .active-tab {
      border-bottom: 3px solid #F97316;
      font-weight: 700;
      color: #F97316;
    }
    .chart-container {
      position: relative;
      width: 100%;
      height: 150px;
    }
    .step-checkbox:checked + .step-text {
      text-decoration: line-through;
      color: #9CA3AF;
    }
    .step-text {
      transition: color 0.3s, text-decoration 0.3s;
    }
    .step-checkbox {
      transform: scale(1.2);
    }
  </style>
</head>
<body class="p-4 bg-gray-50">

  <!-- Bouton Retour visuel et moderne -->
  <div class="mb-6">
    <a href="javascript:history.back()"
       class="inline-flex items-center gap-2 bg-orange-100 hover:bg-orange-200 text-orange-800 font-semibold py-2 px-4 rounded-full shadow-sm transition duration-200 ease-in-out">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
        <path d="M15 19l-7-7 7-7" />
      </svg>
      Retour
    </a>
  </div>

  <div class="container mx-auto max-w-4xl bg-white rounded-xl shadow-2xl p-6 md:p-10 my-8">

    <p class="text-sm font-semibold text-gray-500 italic text-left mb-2">Recette de l'automne</p>

    <header class="text-center mb-10 pb-6 border-b-4 border-orange-100">
      <h1 class="text-4xl md:text-5xl font-extrabold text-orange-700 mb-3 leading-snug flex items-center justify-center flex-wrap">
        <span class="text-4xl md:text-5xl mr-2">üß°</span>
        BUTTERNUT R√îTI AUX √âPICES
        <span class="text-4xl md:text-5xl ml-2">üß°</span>
      </h1>
      <p class="text-xl md:text-2xl font-semibold text-green-600 mt-1 italic">par Yat√© DOUKANSY, 3PMT</p>
    </header>

    <section class="mb-8 flex flex-col md:flex-row gap-6">
      <div class="md:w-1/2">
        <h2 class="text-2xl font-bold text-stone-700 mb-3 flex items-center">Recette V√©g√©tale et Gourmande üçÅ</h2>
        <p class="text-gray-600 leading-relaxed">
          Une mani√®re simple et d√©licieuse de cuisiner le Butternut. La combinaison du <strong>miel (ou sirop d'√©rable)</strong> et des <strong>√©pices</strong> (cannelle, muscade) apporte une saveur sucr√©e-sal√©e parfaite pour l'automne. Id√©al en accompagnement ou en plat v√©g√©tarien l√©ger.
        </p>

        <div class="mt-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200 shadow-sm">
          <h3 class="text-xl font-bold text-yellow-700 flex items-center mb-1">
            <span class="mr-2">üßë‚Äçüç≥</span> Niveau de Difficult√©
          </h3>
          <div id="difficulty-indicator" class="flex items-center gap-2 mt-2"></div>
        </div>

        <div class="mt-4 p-3 bg-green-50 rounded-lg border border-green-200 shadow-sm">
          <h3 class="text-xl font-bold text-green-700 flex items-center mb-1">
            <span class="mr-2">üí°</span> Le saviez-vous ?
            <span class="text-sm font-normal italic ml-2">(par Alice Dulos, TMA)</span>
          </h3>
          <p class="text-sm text-gray-600">
            La couleur orange vif du butternut est due √† sa richesse exceptionnelle en <b class="text-green-800">b√™ta-carot√®ne</b>. Une seule portion peut couvrir <b class="text-green-800">plus de 100%</b> de vos besoins quotidiens en <b class="text-green-800">Vitamine A</b>, essentielle pour la vision et le syst√®me immunitaire.
          </p>
        </div>

        <div class="mt-4 p-3 bg-amber-50 rounded-lg border border-amber-200 shadow-sm">
          <h3 class="text-xl font-bold text-amber-700 flex items-center mb-1">
            <span class="mr-2">‚ôªÔ∏è</span> Astuce Z√©ro Gaspi : Les Graines !
          </h3>
          <p class="text-sm text-gray-600">
            Ne jetez jamais les graines de courge ! Elles sont excellentes r√¥ties. Apr√®s les avoir bien nettoy√©es, m√©langez-les avec un peu d'huile d'olive, de sel, et une pinc√©e de paprika. Faites-les griller s√©par√©ment au four pendant <strong>10 √† 15 minutes</strong>.
          </p>
        </div>
      </div>

      <div id="recipe-times" class="md:w-1/2 p-4 bg-orange-50 rounded-xl shadow-inner border border-orange-200">
        <h3 class="text-xl font-bold text-orange-700 mb-3 text-center">‚è± Temps de la Recette</h3>

        <div class="grid grid-cols-2 md:grid-cols-3 gap-3 text-center">
          <div class="p-3 bg-white rounded-lg shadow-sm border border-orange-100">
            <p class="text-3xl text-orange-600 mb-1">‚è≥</p>
            <p class="text-xl font-bold text-orange-600" id="prep-time-display">15 min</p>
            <p class="text-xs text-gray-500">Pr√©paration</p>
          </div>
          <div class="p-3 bg-white rounded-lg shadow-sm border border-orange-100">
            <p class="text-3xl text-orange-600 mb-1">üî•</p>
            <p class="text-xl font-bold text-orange-600" id="cook-time-display">35 min</p>
            <p class="text-xs text-gray-500">Cuisson</p>
          </div>
          <div class="col-span-2 md:col-span-1 p-3 bg-orange-200 rounded-lg shadow-md border-2 border-orange-300">
            <p class="text-3xl text-orange-800 mb-1">‚è±</p>
            <p class="text-2xl font-extrabold text-orange-800" id="total-time-display">50 min</p>
            <p class="text-sm text-gray-700">Total estim√©</p>
          </div>
        </div>
      </div>
    </section>

    <section class="mb-10 p-6 bg-gray-50 rounded-xl">
      <h2 class="text-2xl font-bold text-stone-700 mb-4">Portions & Visualisation</h2>
      <div class="flex flex-col md:flex-row items-center justify-between gap-6">
        <div class="md:w-1/2 w-full">
          <label for="portions" class="block text-lg font-medium text-gray-700 mb-2 flex items-center">
            <span class="text-3xl mr-2">üë•</span> Choisir le nombre de portions :
          </label>
          <input type="number" id="portions" value="4" min="1" max="12" class="w-full p-3 border border-gray-300 rounded-lg text-2xl text-center focus:ring-orange-500 focus:border-orange-500 shadow-md" />
          <p class="text-sm text-gray-500 mt-2">Les quantit√©s seront automatiquement mises √† jour dans l'onglet 'Ingr√©dients'.</p>
        </div>
        <div class="md:w-1/2 w-full chart-container">
          <canvas id="timeChart"></canvas>
        </div>
      </div>
    </section>

    <section>
      <div class="flex border-b border-gray-200 mb-6">
        <button id="tab-ingredients" class="tab-button text-lg text-gray-500">Ingr√©dients</button>
        <button id="tab-preparation" class="tab-button text-lg text-gray-500 active-tab">Pr√©paration</button>
      </div>

      <div id="content-ingredients" class="tab-content hidden">
        <ul id="ingredients-list" class="space-y-4"></ul>
      </div>

      <div id="content-preparation" class="tab-content">
        <ol id="preparation-list" class="space-y-4"></ol>
      </div>
    </section>

  </div>

  <script type="module">
    const portionsInput = document.getElementById('portions');
    const ingredientsList = document.getElementById('ingredients-list');
    const preparationList = document.getElementById('preparation-list');
    const prepTimeDisplay = document.getElementById('prep-time-display');
    const cookTimeDisplay = document.getElementById('cook-time-display');
    const totalTimeDisplay = document.getElementById('total-time-display');
    const difficultyIndicator = document.getElementById('difficulty-indicator');
    let timeChart = null;

    const BASE_PORTIONS = 4;
    const BASE_PREP_TIME = 15;
    const BASE_COOK_TIME = 35;
    const DIFFICULTY_LEVEL = 1;

    const recipeData = {
      ingredients: [
        { category: "L√©gumes et Fruits", name: "Courge Butternut (chair)", baseAmount: 1500, unit: "g" },
        { category: "Gras et Sucr√©", name: "Huile d'olive", baseAmount: 4, unit: "cs" },
        { category: "Gras et Sucr√©", name: "Miel liquide (ou Sirop d'√©rable)", baseAmount: 2, unit: "cs" },
        { category: "√âpices et Assaisonnement", name: "M√©lange d'√©pices (curry doux ou paprika)", baseAmount: 1.5, unit: "cc" },
        { category: "√âpices et Assaisonnement", name: "Cannelle en poudre", baseAmount: 0.5, unit: "cc" },
        { category: "√âpices et Assaisonnement", name: "Sel fin", baseAmount: 1, unit: "cc" },
        { category: "√âpices et Assaisonnement", name: "Poivre noir fra√Æchement moulu", baseAmount: 0.5, unit: "cc" },
        { category: "Garniture", name: "Graines de courge (pour garniture)", baseAmount: 2, unit: "cs" }
      ],
      preparation: [
        { step: 1, category: "Pr√©paration", text: "<b>Pr√©chauffage et Pr√©paration :</b> Pr√©chauffez le four √† 200¬∞C. Pelez la courge Butternut, coupez-la en deux dans la longueur, retirez les graines. Coupez la chair en cubes." },
        { step: 2, category: "Assaisonnement", text: "<b>Assaisonnement :</b> Dans un grand saladier, m√©langez l'huile d'olive, le miel (ou sirop d'√©rable), le m√©lange d'√©pices, la cannelle, le sel et le poivre." },
        { step: 3, category: "Cuisson", text: "<b>Enrobage et R√¥tissage :</b> M√©langez les cubes avec l‚Äôassaisonnement. √âtalez-les sur une plaque recouverte de papier sulfuris√©. Enfournez pour 35 minutes." },
        { step: 4, category: "Finition", text: "<b>M√©lange et Service :</b> √Ä mi-cuisson (15 min), remuez les cubes pour dorer uniform√©ment. Sortez du four et parsemez des graines de courge grill√©es." }
      ]
    };

    function formatAmount(amount, unit) {
      if (unit === "selon go√ªt") return unit;
      const cleanDecimals = (num, fixed) => num.toFixed(fixed).replace(/\.0+$/, '');
      if (unit === "g") {
        if (amount >= 1000) {
          return cleanDecimals(amount / 1000, 1) + " kg";
        }
        return cleanDecimals(amount, 0) + " g";
      }
      return cleanDecimals(amount, 2) + " " + unit;
    }

    function updateIngredients() {
      const currentPortions = parseInt(portionsInput.value, 10);
      const factor = currentPortions / BASE_PORTIONS;
      ingredientsList.innerHTML = "";

      const categories = {};
      recipeData.ingredients.forEach(item => {
        if (!categories[item.category]) {
          categories[item.category] = [];
        }
        categories[item.category].push(item);
      });

      for (const category in categories) {
        const categoryHeader = document.createElement('h3');
        categoryHeader.className = 'text-xl font-bold text-orange-700 mt-6 mb-3 border-b border-orange-200 pb-1';
        categoryHeader.textContent = category;
        ingredientsList.appendChild(categoryHeader);

        const categoryUl = document.createElement('ul');
        categoryUl.className = 'space-y-3';
        ingredientsList.appendChild(categoryUl);

        categories[category].forEach(item => {
          const li = document.createElement('li');
          const calculated = item.baseAmount * factor;
          const amountString = formatAmount(calculated, item.unit);
          li.className = 'flex items-start text-gray-700 bg-white p-3 rounded-lg shadow-sm hover:bg-orange-50 transition duration-150 ease-in-out';
          li.innerHTML = `
            <input type="checkbox" class="step-checkbox mt-1 mr-3 h-5 w-5 text-orange-600 border-gray-300 rounded focus:ring-orange-500">
            <span class="step-text flex-1">
              <span class="font-bold text-orange-800">${amountString}</span> de ${item.name}
            </span>
          `;
          categoryUl.appendChild(li);
        });
      }
    }

    function displayPreparation() {
      preparationList.innerHTML = "";
      recipeData.preparation.forEach(stepItem => {
        const li = document.createElement('li');
        li.className = 'flex items-start text-gray-700 bg-white p-4 rounded-xl shadow-lg hover:shadow-xl transition duration-300 ease-in-out';
        li.innerHTML = `
          <div class="mr-3 flex-shrink-0">
            <input type="checkbox" id="step-${stepItem.step}" class="step-checkbox mt-1 h-6 w-6 text-orange-600 border-gray-300 rounded-full focus:ring-orange-500">
          </div>
          <label for="step-${stepItem.step}" class="step-text flex-1 text-base leading-relaxed">
            ${stepItem.text}
          </label>
        `;
        preparationList.appendChild(li);
      });
    }

    function updateTimesAndChart() {
      const prepTime = BASE_PREP_TIME;
      const cookTime = BASE_COOK_TIME;
      const totalTime = prepTime + cookTime;
      prepTimeDisplay.textContent = `${prepTime} min`;
      cookTimeDisplay.textContent = `${cookTime} min`;
      totalTimeDisplay.textContent = `${totalTime} min`;

      if (timeChart) {
        timeChart.destroy();
      }
      const ctx = document.getElementById('timeChart').getContext('2d');
      timeChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Pr√©paration', 'Cuisson'],
          datasets: [{
            label: 'Temps de la recette',
            data: [prepTime, cookTime],
            backgroundColor: ['rgba(249, 115, 22, 0.8)', 'rgba(234, 88, 12, 0.8)'],
            hoverOffset: 10,
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '70%',
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                padding: 10,
                font: {
                  size: 14,
                  family: 'Inter, sans-serif'
                }
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  let label = context.label || '';
                  if (label) label += ': ';
                  label += context.parsed + ' minutes';
                  return label;
                }
              }
            }
          }
        }
      });
    }

    function displayDifficulty() {
      difficultyIndicator.innerHTML = '';
      const max = 5;
      for (let i = 1; i <= max; i++) {
        const span = document.createElement('span');
        const filled = i <= DIFFICULTY_LEVEL;
        span.className = `w-5 h-5 rounded-full border-2 border-yellow-500 ${filled ? 'bg-yellow-500' : 'bg-white'}`;
        span.title = filled ? 'Difficult√© Facile' : 'Difficult√© Sup√©rieure';
        difficultyIndicator.appendChild(span);
      }
    }

    function switchTab(activeTabId) {
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active-tab'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
      document.getElementById(`tab-${activeTabId}`).classList.add('active-tab');
      document.getElementById(`content-${activeTabId}`).classList.remove('hidden');
      if (activeTabId === 'ingredients') {
        updateIngredients();
      }
    }

    portionsInput.addEventListener('input', updateIngredients);
    document.getElementById('tab-ingredients').addEventListener('click', () => switchTab('ingredients'));
    document.getElementById('tab-preparation').addEventListener('click', () => switchTab('preparation'));

    document.addEventListener('DOMContentLoaded', () => {
      displayDifficulty();
      updateTimesAndChart();
      displayPreparation();
      updateIngredients();
      switchTab('preparation');
    });
  </script>
</body>
</html>
