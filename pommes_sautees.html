<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pommes saut√©es √† la po√™le</title>
    
    <!-- Chargement de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chargement de Chart.js pour le graphique -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    
    <!-- Configuration de la police Inter (comme demand√©) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        /* Styles personnalis√©s pour am√©liorer les transitions et le rendu */
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f7f7f7; 
            /* Enl√®ve le centrage strict pour mieux g√©rer le d√©filement */
            padding: 1rem;
        }

        /* Styles sp√©cifiques des onglets */
        .tab-button { 
            transition: all 0.2s; 
            padding-top: 0.75rem; /* py-3 */
            padding-bottom: 0.75rem; /* py-3 */
            padding-left: 1.5rem; /* px-6 */
            padding-right: 1.5rem; /* px-6 */
            cursor: pointer;
        }
        .active-tab { 
            border-bottom: 3px solid #10B981; /* Vert √©meraude */
            font-weight: 700; 
            color: #10B981; 
        }

        /* Conteneur pour le graphique Doughnut (petite taille pour la visualisation) */
        .chart-container { 
            position: relative; 
            width: 100%; 
            max-width: 250px; /* Taille fix√©e pour ne pas devenir "trop gros" */
            height: 250px; /* Assure un ratio 1:1 pour le doughnut */
            margin: 0 auto;
        }

        /* --- STYLES DES √âTAPES DE PR√âPARATION AM√âLIOR√âS (liste √† cocher) --- */
        .step-text { 
            transition: color 0.3s, text-decoration 0.3s; 
        }
        .step-checkbox { display: none; }
        
        /* Applique le barr√© et la couleur att√©nu√©e lorsque l'√©tape est coch√©e */
        .step-checkbox:checked + .step-label .step-text { 
            text-decoration: line-through; 
            color: #9CA3AF; 
        }

        /* Style de l'indicateur de coche (le cercle √† droite) lorsqu'il est coch√© */
        .step-checkbox:checked + .step-label > div:last-child { 
            background-color: #059669; /* Green-600 */
            border-color: #059669;
        }

        /* Affiche le SVG checkmark lorsque l'√©tape est coch√©e */
        .step-checkbox:checked + .step-label > div:last-child svg {
            opacity: 1; /* Show checkmark */
        }
        /* --- FIN STYLES √âTAPES --- */

        /* Styles Responsifs pour les cartes de temps sur mobile */
        @media (max-width: 767px) {
            .time-card-grid {
                grid-template-columns: 1fr 1fr; /* 2 colonnes sur mobile */
            }
            .time-card-grid > div:last-child {
                grid-column: span 2; /* Total time prend toute la largeur */
            }
        }

        /* --- STYLES DE DIFFICULT√â (selon l'image fournie) --- */
        /* Style du cercle de difficult√© rempli (Orange) */
        .difficulty-dot {
            display: inline-block;
            width: 1.2rem; /* L√©g√®rement plus grand */
            height: 1.2rem;
            border-radius: 50%;
            background-color: #F97316; /* Orange (Orange-500) */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }
        /* Style du cercle de difficult√© vide (P√™che/Orange clair) */
        .difficulty-dot-empty {
            display: inline-block;
            width: 1.2rem;
            height: 1.2rem;
            border-radius: 50%;
            border: 2px solid #FDBA74; /* Peach (Orange-300) pour la bordure */
            background-color: transparent;
            transition: transform 0.2s;
        }
    </style>
</head>
<body class="bg-gray-50">

    <div class="container mx-auto max-w-4xl bg-white rounded-xl shadow-2xl p-6 md:p-10 my-8">
        
        <!-- EN-T√äTE (MODIFI√â) -->
        <header class="text-center mb-10 pb-6 border-b-4 border-green-100">
            <!-- TITRE PRINCIPAL DE LA RECETTE (mb-0 pour supprimer l'espace du bas) -->
            <h1 class="text-4xl md:text-5xl font-extrabold text-green-700 leading-snug mb-0">
                POMMES SAUT√âES √Ä LA PO√äLE
            </h1>
            <!-- Auteurs/Sous-titre, coll√© au titre principal (mt-1 pour une s√©paration minimale) -->
            <p class="text-xl md:text-2xl font-semibold text-gray-600 mt-1 italic">par Reda Chibah et Yat√© Doukansy, 3PMT</p>
        </header>

        <!-- DESCRIPTION & TEMPS -->
        <section class="mb-8 flex flex-col md:flex-row gap-6">
            <!-- Colonne principale (Description, Difficult√©, Faits) - Prend 60% sur desktop -->
            <div class="md:w-3/5">
                <h2 class="text-2xl font-bold text-stone-700 mb-3 flex items-center">Recette Gourmande & Rapide üå±</h2>
                <!-- TEXTE JUSTIFI√â -->
                <p class="text-gray-600 leading-relaxed text-justify">
                    Ce dessert simple et sain est parfait pour utiliser des pommes m√ªres. En utilisant un fond d'eau et la chaleur, les pommes caram√©lisent naturellement gr√¢ce √† leurs sucres, sans n√©cessiter l'ajout de mati√®res grasses. Id√©al comme garniture de cr√™pes, de yaourts, ou simplement nature.
                </p>

                <!-- Indicateur de difficult√© (MIS √Ä JOUR) -->
                <!-- Utilisation de bg-yellow-50 et border-yellow-200 pour coller au style de l'image fournie -->
                <div class="mt-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200 shadow-sm">
                    <h3 class="text-xl font-bold text-yellow-700 flex items-center mb-1">
                        <!-- Nouveau Chef Emoji et texte mis √† jour -->
                        <span class="mr-2 text-2xl">üë®‚Äçüç≥</span> Niveau de Difficult√© (Tr√®s facile)
                    </h3>
                    <div id="difficulty-indicator" class="flex items-center gap-2 mt-2">
                        <!-- Les indicateurs de difficult√© (cercles) seront ins√©r√©s ici par JS -->
                    </div>
                </div>

                <!-- NOUVELLES RUBRIQUES -->
                <div class="mt-4 space-y-4">
                    <!-- Proverbe C√©l√®bre -->
                    <div class="p-4 bg-red-50 rounded-lg border border-red-200 shadow-sm">
                        <h3 class="text-lg font-bold text-red-700 flex items-center mb-1">
                            <span class="mr-2 text-2xl">üåç</span> Proverbe C√©l√®bre
                        </h3>
                        <p class="text-gray-700 text-sm italic font-medium text-red-600">
                            "An apple a day, keeps the doctor away"
                        </p>
                        <!-- TEXTE JUSTIFI√â -->
                        <p class="text-gray-600 text-sm mt-1 text-justify">
                            (Une pomme par jour √©loigne le m√©decin) ‚Äì Un fruit simple mais aux bienfaits multiples !
                        </p>
                    </div>

                    <!-- Astuce 'Sans Gras' -->
                    <div class="p-4 bg-yellow-50 rounded-lg border border-yellow-200 shadow-sm">
                        <h3 class="text-lg font-bold text-yellow-700 flex flex-col items-start mb-1">
                            <span class="flex items-center">
                                <span class="mr-2 text-2xl">üí°</span> Astuce 'Sans Gras'
                            </span>
                        </h3>
                        <!-- TEXTE JUSTIFI√â -->
                        <p class="text-gray-600 text-sm text-justify">
                            Pour obtenir des pommes bien dor√©es sans beurre, utilisez une <b>po√™le antiadh√©sive</b>. L'astuce est de d√©marrer la cuisson √† feu moyen-fort avec un fond d'eau (2 cuill√®res √† soupe) pour √©viter que les pommes ne collent avant que leur propre jus ne soit lib√©r√©.
                        </p>
                    </div>

                    <!-- "Accompagnement Recommand√©" -->
                    <div class="p-4 bg-blue-50 rounded-lg border border-blue-200 shadow-sm">
                        <h3 class="text-lg font-bold text-blue-700 flex items-center mb-1">
                            <span class="mr-2 text-2xl">‚òï</span> Id√©e d'Accompagnement
                        </h3>
                        <!-- TEXTE JUSTIFI√â -->
                        <p class="text-gray-700 text-sm text-justify">
                            Servez ces pommes avec une cuill√®re de <b>fromage blanc</b> et une pinc√©e de granola croquant pour un contraste de textures parfait.
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Cadre des Temps - Prend 40% sur desktop (moins √©tendu) -->
            <div id="recipe-times" class="md:w-2/5 p-4 bg-green-50 rounded-lg shadow-inner border border-green-200 md:self-center">
                <h3 class="text-xl font-bold text-green-700 mb-3 text-center">‚è± Temps Total</h3>
                <div class="grid time-card-grid grid-cols-3 gap-3 text-center">
                    <div>
                        <p class="text-3xl text-green-600 mb-1">‚è≥</p>
                        <p class="text-2xl font-bold text-green-600" id="prep-time-display">10 min</p>
                        <p class="text-sm text-gray-500">Pr√©paration</p>
                    </div>
                    <div>
                        <p class="text-3xl text-green-600 mb-1">üî•</p>
                        <p class="text-2xl font-bold text-green-600" id="cook-time-display">15 min</p>
                        <p class="text-sm text-gray-500">Cuisson</p>
                    </div>
                    <div class="col-span-full md:col-span-1 border-t md:border-t-0 md:border-l border-green-200 pt-3 md:pt-0">
                        <p class="text-3xl text-green-700 mb-1">‚è±</p>
                        <p class="text-2xl font-bold text-green-700" id="total-time-display">25 min</p>
                        <p class="text-sm text-gray-500">Total</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- PORTIONS & GRAPHIQUE -->
        <section class="mb-10 p-6 bg-gray-50 rounded-xl">
            <h2 class="text-2xl font-bold text-stone-700 mb-4">Portions & Visualisation</h2>
            
            <div class="flex flex-col md:flex-row items-center justify-between gap-6">
                <!-- Portions Input -->
                <div class="md:w-1/2 w-full"> 
                    <label for="portions" class="block text-lg font-medium text-gray-700 mb-2 flex items-center">
                        <span class="text-3xl mr-2">üë•</span> Choisir le nombre de portions :
                    </label>
                    <input type="number" id="portions" value="2" min="1" max="8" class="w-full p-3 border border-gray-300 rounded-lg text-2xl text-center focus:ring-green-500 focus:border-green-500 shadow-md">
                    <p class="text-sm text-gray-500 mt-2">Les quantit√©s seront automatiquement mises √† jour dans l'onglet 'Ingr√©dients'.</p>
                </div>

                <!-- Time Chart -->
                <div class="md:w-1/2 w-full chart-container">
                    <canvas id="timeChart"></canvas>
                </div>
            </div>
        </section>

        <!-- CONTENU (ONGLETS) -->
        <section>
            <!-- Boutons d'onglet -->
            <div class="flex border-b border-gray-200 mb-6">
                <button id="tab-ingredients" class="tab-button text-lg text-gray-500">Ingr√©dients</button>
                <button id="tab-preparation" class="tab-button text-lg text-gray-500 active-tab">Pr√©paration</button>
            </div>

            <!-- Contenu Ingr√©dients -->
            <div id="content-ingredients" class="tab-content hidden">
                <ul id="ingredients-list" class="space-y-3">
                </ul>
            </div>

            <!-- Contenu Pr√©paration -->
            <div id="content-preparation" class="tab-content">
                <ol id="preparation-list" class="space-y-5">
                </ol>
            </div>
        </section>

    </div>

    <!-- Bouton de retour (fixe) - La cible est g√©n√©rique car l'index n'existe pas ici -->
    <div class="fixed bottom-4 left-4 z-50">
        <a href="#" id="back-link" class="inline-flex items-center px-4 py-3 bg-white text-gray-700 font-bold rounded-full shadow-2xl transition duration-300 ease-in-out hover:bg-green-600 hover:text-white transform hover:scale-105">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12"></path></svg>
            <span class="ml-2 hidden sm:inline">Retour aux recettes</span>
            <span class="ml-2 inline sm:hidden">Retour</span>
        </a>
    </div>

    <script>
        const portionsInput = document.getElementById('portions');
        const ingredientsList = document.getElementById('ingredients-list');
        const preparationList = document.getElementById('preparation-list');
        const prepTimeDisplay = document.getElementById('prep-time-display');
        const cookTimeDisplay = document.getElementById('cook-time-display');
        const totalTimeDisplay = document.getElementById('total-time-display');
        const difficultyIndicator = document.getElementById('difficulty-indicator');
        
        let timeChart = null; 
        
        // --- DONN√âES DE LA RECETTE ---
        const BASE_PORTIONS = 2; // Recette de base pour 2 personnes
        const BASE_PREP_TIME = 10; // min
        const BASE_COOK_TIME = 15; // min
        // Niveau de difficult√© mis √† jour √† 2/5 (selon l'image "Facile")
        const DIFFICULTY_LEVEL = 2; 
        const MAX_DIFFICULTY = 5; // Total de 5 points pour la difficult√©

        const recipeData = {
            ingredients: [
                { category: "Fruits", name: "Pommes (vari√©t√© ferme : Gala, Reinette, Granny)", baseAmount: 2, unit: "grosses" },
                { category: "Assaisonnement", name: "Cannelle en poudre", baseAmount: 0.5, unit: "cc" },
                { category: "Assaisonnement", name: "Extrait de vanille", baseAmount: 5, unit: "ml" },
                { category: "Liquide", name: "Eau", baseAmount: 30, unit: "ml" },
                // Modification: Remplacement du sucre/√©dulcorant par du miel/sirop
                { category: "Optionnel", name: "Miel ou Sirop d'√©rable (pour le go√ªt et la caram√©lisation, selon le go√ªt)", baseAmount: 0.5, unit: "cs" }
            ],
            // SUITE DE LA LOGIQUE DE PR√âPARATION (qui √©tait coup√©e)
            preparation: [
                { step: 1, category: "Pr√©paration", text: "<b>Pr√©parer les pommes :</b> Lavez, √©pluchez et √©p√©pinez les pommes. Coupez-les en d√©s ou en quartiers r√©guliers (environ 1.5 cm d'√©paisseur) pour assurer une cuisson uniforme." },
                { step: 2, category: "Cuisson", text: "<b>Cuisson 'sans gras' :</b> Dans une po√™le antiadh√©sive √† feu moyen-fort, versez l'eau. Ajoutez imm√©diatement les morceaux de pommes, la cannelle et la vanille. Si vous utilisez du miel/sirop, ajoutez-le maintenant." },
                { step: 3, category: "Cuisson", text: "<b>Caram√©lisation :</b> Couvrez la po√™le et laissez cuire pendant 5 minutes. Les pommes vont devenir tendres et leur propre jus va se lib√©rer. Retirez ensuite le couvercle et augmentez le feu √† moyen-vif." },
                { step: 4, category: "Finition", text: "<b>Dorage :</b> Laissez cuire √† d√©couvert pendant environ 10 minutes suppl√©mentaires, en remuant fr√©quemment, jusqu'√† ce que le liquide soit √©vapor√© et que les pommes commencent √† dorer et caram√©liser l√©g√®rement. Si elles collent, baissez l√©g√®rement le feu et ajoutez une cuill√®re √† soupe d'eau si n√©cessaire." },
                { step: 5, category: "Service", text: "<b>Servir :</b> Retirez du feu et servez chaud ou ti√®de. Elles sont d√©licieuses natures ou accompagn√©es d'un yaourt v√©g√©tal." }
            ]
        };

        // Fonction d'arrondi (pour g√©rer les d√©cimales)
        function formatAmount(amount) {
            if (amount % 1 === 0) {
                return amount;
            }
            // Arrondir √† la d√©cimale la plus proche ou conserver les fractions courantes
            if (amount === 0.25) return '1/4';
            if (amount === 0.5) return '1/2';
            if (amount === 0.75) return '3/4';
            
            return Math.round(amount * 10) / 10;
        }

        // --- GESTION DES QUANTIT√âS ET DE L'AFFICHAGE DES INGR√âDIENTS ---
        function renderIngredients(currentPortions) {
            ingredientsList.innerHTML = '';
            const factor = currentPortions / BASE_PORTIONS;

            // Utilisation d'un Map pour regrouper les ingr√©dients par cat√©gorie
            const groupedIngredients = new Map();
            recipeData.ingredients.forEach(ing => {
                const category = ing.category;
                if (!groupedIngredients.has(category)) {
                    groupedIngredients.set(category, []);
                }
                groupedIngredients.get(category).push(ing);
            });

            groupedIngredients.forEach((ingredients, category) => {
                // Ajouter le titre de cat√©gorie
                const categoryHeader = document.createElement('li');
                categoryHeader.className = 'text-lg font-bold text-stone-700 mt-4 mb-2 border-b border-green-200';
                categoryHeader.textContent = category;
                ingredientsList.appendChild(categoryHeader);

                // Ajouter les ingr√©dients
                ingredients.forEach(ing => {
                    const listItem = document.createElement('li');
                    
                    // Calcul de la quantit√© ajust√©e
                    const adjustedAmount = formatAmount(ing.baseAmount * factor);
                    const amountText = adjustedAmount > 0 ? adjustedAmount : '';
                    const unitText = amountText ? ing.unit : '';

                    listItem.className = 'flex items-start text-gray-700';
                    listItem.innerHTML = `
                        <span class="mr-2 text-green-500 font-extrabold text-xl">‚Ä¢</span>
                        <div class="flex flex-col">
                            <span class="font-semibold">${amountText} ${unitText}</span>
                            <span class="text-sm text-gray-600">${ing.name}</span>
                        </div>
                    `;
                    ingredientsList.appendChild(listItem);
                });
            });
        }

        // --- GESTION DES √âTAPES DE PR√âPARATION (avec cases √† cocher) ---
        function renderPreparation() {
            preparationList.innerHTML = '';
            recipeData.preparation.forEach(item => {
                const listItem = document.createElement('li');
                listItem.className = 'relative p-4 border border-gray-200 rounded-xl bg-white shadow-sm hover:shadow-md transition duration-200';
                
                // Utilisation d'une checkbox cach√©e et d'un label stylis√©
                listItem.innerHTML = `
                    <input type="checkbox" id="step-${item.step}" class="step-checkbox">
                    <label for="step-${item.step}" class="step-label flex justify-between items-start cursor-pointer">
                        <!-- Texte de l'√©tape -->
                        <div class="flex-1 mr-4">
                            <span class="text-xl font-bold text-green-700 mr-2">${item.step}.</span>
                            <span class="step-text text-gray-800" style="line-height: 1.5;">${item.text}</span>
                        </div>
                        
                        <!-- Indicateur de coche stylis√© (cercle √† droite) -->
                        <div class="w-7 h-7 flex items-center justify-center border-2 border-gray-400 rounded-full transition duration-300 flex-shrink-0 mt-1">
                            <!-- SVG du V (initialement transparent) -->
                            <svg class="w-4 h-4 text-white opacity-0 transition duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </div>
                    </label>
                `;
                preparationList.appendChild(listItem);
            });
        }

        // --- GESTION DU GRAPHIQUE DE TEMPS ---
        function initChart() {
            const ctx = document.getElementById('timeChart').getContext('2d');
            if (timeChart) {
                timeChart.destroy(); // D√©truit l'instance pr√©c√©dente si elle existe
            }
            timeChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Pr√©paration', 'Cuisson'],
                    datasets: [{
                        data: [BASE_PREP_TIME, BASE_COOK_TIME],
                        backgroundColor: [
                            '#34D399', // Vert clair (Pr√©paration)
                            '#059669', // Vert fonc√© (Cuisson)
                        ],
                        hoverOffset: 10,
                        borderWidth: 0,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // Permet au chart-container de contr√¥ler la taille
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 10,
                                font: {
                                    family: 'Inter',
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += context.parsed + ' min';
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    cutout: '70%', // √âpaisseur de l'anneau
                }
            });
        }

        // --- GESTION DE LA DIFFICULT√â (MIS √Ä JOUR) ---
        function renderDifficulty() {
            const level = DIFFICULTY_LEVEL; // Vaut 2 (Facile)
            const total = MAX_DIFFICULTY; // Vaut 5
            difficultyIndicator.innerHTML = '';
            
            // 1. Afficher les points remplis (selon le niveau)
            for (let i = 0; i < level; i++) {
                const dot = document.createElement('span');
                dot.className = `difficulty-dot mr-1`; // Point rempli (Orange)
                difficultyIndicator.appendChild(dot);
            }
            
            // 2. Afficher les points vides (total - niveau)
            for (let i = level; i < total; i++) {
                const dot = document.createElement('span');
                dot.className = `difficulty-dot-empty mr-1`; // Point vide (P√™che)
                difficultyIndicator.appendChild(dot);
            }
        }

        // --- GESTION DES ONGLET (Tabs) ---
        function setupTabs() {
            const tabs = [
                { buttonId: 'tab-ingredients', contentId: 'content-ingredients' },
                { buttonId: 'tab-preparation', contentId: 'content-preparation' },
            ];

            const tabButtons = tabs.map(tab => document.getElementById(tab.buttonId));
            const tabContents = tabs.map(tab => document.getElementById(tab.contentId));

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Masquer tous les contenus et d√©sactiver tous les boutons
                    tabContents.forEach(content => content.classList.add('hidden'));
                    tabButtons.forEach(btn => btn.classList.remove('active-tab', 'text-gray-800'));
                    
                    // Activer le contenu et le bouton cliqu√©
                    const targetContentId = tabs.find(tab => tab.buttonId === button.id).contentId;
                    document.getElementById(targetContentId).classList.remove('hidden');
                    button.classList.add('active-tab', 'text-gray-800');
                });
            });

            // Initialiser sur l'onglet "Pr√©paration" par d√©faut
            document.getElementById('content-ingredients').classList.add('hidden');
            document.getElementById('tab-ingredients').classList.remove('active-tab', 'text-gray-800');
            document.getElementById('tab-preparation').classList.add('active-tab', 'text-gray-800');
        }

        // --- GESTION DES √âV√âNEMENTS & INITIALISATION ---

        function updateRecipe() {
            const currentPortions = parseInt(portionsInput.value) || BASE_PORTIONS;
            // Assurer que les portions sont dans la plage min/max
            if (currentPortions < portionsInput.min || currentPortions > portionsInput.max) return;
            
            renderIngredients(currentPortions);
        }

        // √âv√©nement sur changement de portions
        portionsInput.addEventListener('input', updateRecipe);

        // Initialisation √† l'ouverture de la page
        document.addEventListener('DOMContentLoaded', () => {
            renderDifficulty();
            renderPreparation();
            initChart();
            setupTabs();
            // Lancer l'update initial des quantit√©s pour 2 portions
            updateRecipe(); 
        });
    </script>
</body>
</html>
